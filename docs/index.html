<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">

    <link href="https://fonts.googleapis.com/css?family=Inconsolata|Oswald|Roboto+Condensed:700" rel="stylesheet">
    <script type="text/javascript" src="./bundles/index.js"></script>
</head>
<body>

    <h1>Pillow performance</h1>

    <section>
        <h2>Resampling</h2>

        <p>
            Image resampling is one of the most common processing operations.
            Good resampling can be achieved with
            <a href="http://www.imagemagick.org/Usage/filter/#filter">
                convolution-based</a> method.
        </p>
        <p>
            "Convolution" means that for each pixel in the final image
            we compute some area ("window")
            from the source image using weights.
            Size of the area and weights values depend on choosen filter.
            There are many filters.
            This is most common:
        </p>
        <ul>
            <li><code>Bilinear</code> — higly-efficient filter
                with small window and blurry result;</li>
            <li><code>Bicubic</code> — high-quality filter with medium window;</li>
            <li><code>Lanczos</code> — allows trade a quality over performance
                in some cases.</li>
        </ul>   
        <p>
            Also, when we downscaling the image,
            we need to increase the window size
            to do not loose the original image pixels.
            Unfortunately, not all libraries and programs do this.
            As a result, output images can look extra sharp and crisp.
            In some cases the result can
            only vaguely reminiscent of the original.
        </p>
        <p>
            This is results of resizing
            <a href="https://unsplash.com/photos/h0N_2iZMA_4" target="_blank">
                4912 × 7360 image</a> to 150 × 225 px
            using different software and different filters.
            OpenCV doesn't increase the window size
            on downscaling using <code>Bicubic</code> filter,
            but offers supersampling
            (different resampling method,
            not based on convolutions).
        </p>
        <div class="samples">
            <figure>
                <img src="./static/bridge_cv2_cubic.png" alt="CV2 Cubic" width="150" />
                <figcaption>CV2 Cubic</figcaption>
            </figure>
            <figure>
                <img src="./static/bridge_cv2_area.png" alt="CV2 Area" width="150" />
                <figcaption>CV2 Area (supersampling)</figcaption>
            </figure>
            <figure>
                <img src="./static/bridge_pil_bicubic.png" alt="PIL Bicubic" width="150" />
                <figcaption>PIL Bicubic</figcaption>
            </figure>
            <figure>
                <img src="./static/bridge_pil_lanczos.png" alt="PIL Lanczos" width="150" />
                <figcaption>PIL Antialias (Lanczos)</figcaption>
            </figure>
            <figure>
                <img src="./static/bridge_pillow_bicubic.png" alt="Pillow Bicubic" width="150" />
                <figcaption>Pillow Bicubic</figcaption>
            </figure>
        </div>
        <p>
            From the very begining PIL also doesn't increase the window size
            for <code>Bilinear</code> and <code>Bicubic</code> filters,
            while does for <code>Antialias</code>
            (the real name of used filter is
            <a href="https://en.wikipedia.org/wiki/Lanczos_algorithm">
                Lanczos</a>).
            In Pillow this was fixed in version <code>2.7.0</code>.
        </p>
    </section>

    <section>
        <h2>Libraries</h2>

        <dl class="libraries">
            <dt>PIL</dt>
            <dd>
                Python image library. Was initialy released for Python 1.2 in 1995.
                Last version is 1.1.7 was released on November 15, 2009.
                Includes image codecs and image manipulation routines.
            </dd>

            <dt>Pillow</dt>
            <dd>
                PIL fork. Originally was designed to simplify installation
                in the modern environment. Starting from version 2.0 (2013)
                supports Python 3 and is actively maintained and developed.
            </dd>

            <dt>Pillow SIMD</dt>
            <dd>
                Highly optimized "following" Pillow fork with speedups
                for some common operations using SIMD inctructions.
            </dd>
            
            <dt>ImageMagick</dt>
            <dd>
                Very popular image manipulation library with many bindings
                for different languages. Extremely configurable.
            </dd>

            <dt>Skia</dt>
            <dd>
                Highly efficient 2D graphics library. It serves as the graphics
                engine for Chrome and Chrome OS, Android, Firefox and Firefox OS.
            </dd>
        </dl>
    </section>

    <div class="selects-grid">
        <div class="selects-grid__inner">
            <div class="selects-grid__cell">
                <h4>System</h4>
                <ul class="select -large" id="select-system"></ul>
                <p class="info"></p>
            </div>

            <div class="selects-grid__cell">
                <h4>Chart set</h4>
                <ul class="select" id="select-preset"></ul>

                <div class="topic -resize-27">
                    <p>
                        From very begining Pillow and PIL image resampling
                        performance used to be quite low and comparable to
                        ImageMagick performance.
                    </p>
                    <p>
                        Pillow 2.7 reverse the trend introducing several
                        common optimizations.
                    </p>
                </div>

                <div class="topic -resize-progress">
                    <p>
                        Starting from Pillow 2.7 the performance is constantly
                        growing.
                    </p>
                    <p>
                        Pillow 3.3 uses only fixed-point arithmetic
                        which is much faster. Pillow 3.4 has additional
                        optimizations for large target dimensions.
                    </p>
                </div>
            </div>
        </div>

        <div class="selects-grid__cell">
            <h4>Competition</h4>
            <ul class="select -large" id="select-competition"></ul>

            <div class="topic -resample">
                <p>
                    The test includes libraries which provide
                    <a href="http://www.imagemagick.org/Usage/filter/#filter">
                        high-quality convolution-based</a>
                    resampling using filters.
                </p>

                <p>
                    There are three filters with differts window size
                    and different complexity:
                </p>

                <ul>
                    <li>Bilinear — higly-efficient filter with small window
                        and blurry result;</li>
                    <li>Bicubic — high-quality filter with medium window;</li>
                    <li>Lanczos — allows trade a quality over performance
                        in some cases.</li>
                </ul>            
            </div>

            <div class="topic -blur">
                <p>
                    High-quality
                    <a href="https://en.wikipedia.org/wiki/Gaussian_blur">
                        gaussian blur</a>.
                </p>

                <p>
                    Starting from Pillow 2.7 the Gaussian blur implementation is 
                    based on the
                    <a href="http://www.mia.uni-saarland.de/Publications/gwosdek-ssvm11.pdf">
                        Mathematical Image Analysis Group work</a>
                    and operates in constant time related to blur radius.
                </p>
            </div>
        </div>
    </div>

    <canvas id="chart-container" width="1100" height="400"></canvas>

</body>
</html>
